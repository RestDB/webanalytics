<!DOCTYPE html>
<html lang="en" x-data="{ theme: 'light' }" :data-theme="theme">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@3.7.3/dist/full.css" rel="stylesheet" type="text/css" />
    <link href="output.css" rel="stylesheet" type="text/css" />
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>
     <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        .leaflet-container {
			height: 400px;
			width: 100%;
			max-width: 100%;
			max-height: 100%;
		}
        .card-title {
            font-size: 1.25rem; /* Reduced font size */
        }
        .card {
            border-radius: 0.25rem; /* Sharper corner radius */
        }
    </style>
</head>
<body x-data="dashboard()">
    <div class="container mx-auto p-4">
        <h1 class="text-3xl font-bold mb-6">Analytics Dashboard</h1>

        <!-- Theme toggle -->
        <div class="absolute top-4 right-4">
            <input type="checkbox" class="toggle" x-model="theme" @change="theme = $event.target.checked ? 'dark' : 'light'" />
        </div>

        <!-- Period Selector -->
        <div class="tabs tabs-boxed mb-4">
            <a class="tab" :class="{ 'tab-active': period === 'day' }" @click="period = 'day'; updateStats()">Today</a>
            <a class="tab" :class="{ 'tab-active': period === 'yesterday' }" @click="period = 'yesterday'; updateStats()">Yesterday</a>
            <a class="tab" :class="{ 'tab-active': period === 'week' }" @click="period = 'week'; updateStats()">Last 7 days</a>
            <a class="tab" :class="{ 'tab-active': period === 'month' }" @click="period = 'month'; updateStats()">Last 30 days</a>
            <a class="tab" :class="{ 'tab-active': period === 'year' }" @click="period = 'year'; updateStats()">One Year</a>
        </div>

        <!-- Unique Users, Active Users, Bounce Rate, and Avg Time Cards -->
        <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-5">
            <!-- Combined Card for Mobile -->
            <div class="card bg-neutral text-neutral-content shadow-xl md:hidden">
                <div class="card-body">
                    <table class="w-full">
                        <tr>
                            <td class="text-base">People</td>
                            <td class="text-base text-right">
                                <span x-show="!loading" x-text="uniqueUsers"></span>
                                <span x-show="loading" class="loading loading-spinner loading-sm"></span>
                            </td>
                        </tr>
                        <tr>
                            <td class="text-base">Views</td>
                            <td class="text-base text-right">
                                <span x-show="!loading" x-text="totalPageViews"></span>
                                <span x-show="loading" class="loading loading-spinner loading-sm"></span>
                            </td>
                        </tr>
                        <tr>
                            <td class="text-base">Bounce</td>
                            <td class="text-base text-right">
                                <span x-show="!loading" x-text="`${bounceRate} %`"></span>
                                <span x-show="loading" class="loading loading-spinner loading-sm"></span>
                            </td>
                        </tr>
                        <tr>
                            <td class="text-base">Time on Site</td>
                            <td class="text-base text-right">
                                <span x-show="!loading" x-text="`${averageSessionDuration.minutes}:${averageSessionDuration.seconds}`"></span>
                                <span x-show="loading" class="loading loading-spinner loading-sm"></span>
                            </td>
                        </tr>
                        <tr>
                            <td class="text-base">Events</td>
                            <td class="text-base text-right">
                                <span x-show="!loading" x-text="eventCompletions"></span>
                                <span x-show="loading" class="loading loading-spinner loading-sm"></span>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>

            <!-- Individual Cards for Larger Screens -->
            <div class="hidden md:block card bg-neutral text-neutral-content shadow-xl">
                <div class="card-body">
                    <h2 class="card-title">People</h2>
                    <p class="text-xl"> <!-- Removed font-bold -->
                        <span x-show="!loading" x-text="uniqueUsers"></span>
                        <span x-show="loading" class="loading loading-spinner loading-sm"></span>
                    </p>
                </div>
            </div>
            
            <div class="hidden md:block card bg-neutral text-neutral-content shadow-xl">
                <div class="card-body">
                    <h2 class="card-title">Views</h2>
                    <p class="text-xl"> <!-- Removed font-bold -->
                        <span x-show="!loading" x-text="totalPageViews"></span>
                        <span x-show="loading" class="loading loading-spinner loading-sm"></span>
                    </p>
                </div>
            </div>
            
            <div class="hidden md:block card bg-neutral text-neutral-content shadow-xl">
                <div class="card-body">
                    <h2 class="card-title">Bounce</h2>
                    <p class="text-xl"> <!-- Removed font-bold -->
                        <span x-show="!loading" x-text="`${bounceRate} %`"></span>
                        <span x-show="loading" class="loading loading-spinner loading-sm"></span>
                    </p>
                </div>
            </div>
            
            <div class="hidden md:block card bg-neutral text-neutral-content shadow-xl">
                <div class="card-body">
                    <h2 class="card-title">Time on Site</h2>
                    <p class="text-xl"> <!-- Removed font-bold -->
                        <span x-show="!loading" x-text="`${averageSessionDuration.minutes}:${averageSessionDuration.seconds}`"></span>
                        <span x-show="loading" class="loading loading-spinner loading-sm"></span>
                    </p>
                </div>
            </div>
            
            <div class="hidden md:block card bg-neutral text-neutral-content shadow-xl">
                <div class="card-body">
                    <h2 class="card-title">Events</h2>
                    <p class="text-xl"> <!-- Removed font-bold -->
                        <span x-show="!loading" x-text="eventCompletions"></span>
                        <span x-show="loading" class="loading loading-spinner loading-sm"></span>
                    </p>
                </div>
            </div>
        </div>
        <!-- Traffic graph -->
        <div class="card bg-base-100 shadow-xl mb-4">
            <div class="card-body">                
                <canvas id="traffic-graph" class="w-full h-36"></canvas>
            </div>
        </div>
        <!-- Top 10 Pages and Top 5 Referrers -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <!-- Top 10 Pages -->
            <div class="card bg-base-100 shadow-xl">
                <div class="card-body">
                    <h2 class="card-title">Top Pages</h2>
                    <table class="table-auto">
                        <thead>
                            <tr>
                                <th class="text-left font-semibold pr-4">Page URL</th>
                                <th class="text-right font-semibold">Views</th>
                            </tr>
                        </thead>
                        <tbody>
                            <template x-for="page in topPages" :key="page.url">
                                <tr>
                                    <td class="py-1 pr-4">
                                        <span x-text="page.url"></span>
                                    </td>
                                    <td class="text-sm text-gray-500 text-right">
                                        <span x-text="page.views"></span>
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Top 5 Referrers -->
            <div class="card bg-base-100 shadow-xl">
                <div class="card-body">
                    <h2 class="card-title">Top Referrers</h2>
                    <table class="table-auto">
                        <thead>
                            <tr>
                                <th class="text-left font-semibold pr-4">Referrer</th>
                                <th class="text-right font-semibold">Views</th>
                            </tr>
                        </thead>
                        <tbody>
                            <template x-for="referer in topReferers" :key="referer.url">
                                <tr>
                                    <td class="py-1 pr-4">
                                        <span x-text="referer.url"></span>
                                    </td>
                                    <td class="text-sm text-gray-500 text-right">
                                        <span x-text="referer.views"></span>
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Top 5 Countries and Top 5 Custom Events -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <!-- Top 5 Countries -->
            <div class="card bg-base-100 shadow-xl">
                <div class="card-body">
                    <h2 class="card-title">Top Countries</h2>
                    <table class="table-auto">
                        <thead>
                            <tr>
                                <th class="text-left font-semibold pr-4">Country</th>
                                <th class="text-right font-semibold">People</th>
                            </tr>
                        </thead>
                        <tbody>
                            <template x-for="country in topCountries" :key="country.country">
                                <tr>
                                    <td class="py-1 pr-4">
                                        <span x-text="country.country"></span>
                                    </td>
                                    <td class="text-sm text-gray-500 text-right">
                                        <span x-text="country.views"></span>
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Top 5 Custom Events -->
            <div class="card bg-base-100 shadow-xl">
                <div class="card-body">
                    <h2 class="card-title">Top 5 Custom Events</h2>
                    <table class="table-auto">
                        <thead>
                            <tr>
                                <th class="text-left font-semibold pr-4">Event</th>
                                <th class="text-right font-semibold">Views</th>
                            </tr>
                        </thead>
                        <tbody>
                            <template x-for="event in topEvents" :key="event.event">
                                <tr>
                                    <td class="py-1 pr-4">
                                        <span x-text="event.event"></span>
                                    </td>
                                    <td class="text-sm text-gray-500 text-right">
                                        <span x-text="event.views"></span>
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- World Map -->
        <div class="card bg-base-100 shadow-xl mb-4">
            <div class="card-body h-[500px]">
                <h2 class="card-title">User Distribution</h2>
                <div id="world_map" class="w-full h-full">
                    <!-- World map will be inserted here -->
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>